<?xml version="1.0" encoding="UTF-8"?>

<project name="jeventviewer" default="compile" basedir=".">

    <!-- enviromental variables -->
    <property environment="env"/>
    
    <!-- Version -->
    <property name="jev.version" value="1.0" />

    <!-- Debug -->
    <property name="javac.debug" value="on" />

    <!-- Classpath , env CLASSPATH is first, internal is second -->
    <property name="build.sysclasspath" value="first" />

    <!-- Directories/Files -->
    <property name="src.dir"       value="java" />
    <property name="build.dir"     value="build" />
    <property name="build.classes" value="${build.dir}/classes" />
    <property name="build.lib"     value="${build.dir}/lib" />
    <property name="doc.dir"       value="doc/javadoc" />
    <property name="jarName"       value="${build.lib}/JEventViewer-${jev.version}.jar" />

    <!-- Targets -->
    
    <!-- Help -->
    <target name="help">
        <echo message="Usage: ant [ant options] &lt;target1&gt; [target2 | target3 | ...]" />
        <echo message="" />
        <echo message="       targets:" />
        <echo message="       help       - print out usage" />
        <echo message="       env        - print out build file variables' values" />
        <echo message="       compile    - compile java files" />
        <echo message="       clean      - remove class files" />
        <echo message="       cleanall   - remove all generated files" />
        <echo message="       jar        - compile and create jar file" />
        <echo message="       install    - create jar file and install into CODA" />
        <echo message="                    if defined (in that order)" />
        <echo message="       all        - clean, compile and create jar file" />
        <echo message="       javadoc    - create javadoc documentation" />
        <echo message="       developdoc - create javadoc documentation for developer" />
        <echo message="       prepare    - create necessary directories" />
    </target>
    
    <!-- Environment -->
    <target name="env">
        <echo message="Ant environment:" />
        <echo message="" />
        <echo message="    src.dir       = ${src.dir}" />
        <echo message="    build.dir     = ${build.dir}" />
        <echo message="    build.lib     = ${build.lib}" />
        <echo message="    build.classes = ${build.classes}" />
        <echo message="    doc.dir       = ${doc.dir}" />
        <echo message="    javac.debug   = ${javac.debug}" />
        <echo message="    classpath     = ${env.CLASSPATH}" />
    </target>
    
    <!-- Prepare things by creating directories -->
    <target name="prepare">
        <mkdir dir="${build.dir}" />
        <mkdir dir="${build.classes}" />
        <mkdir dir="${build.lib}" />
    </target>

    <!-- Clean by removing class files -->
    <target name="clean" description="Remove all class files">
        <delete failonerror="no" >
            <fileset dir="${build.classes}" includes="**/*.class" />
        </delete>
    </target>
    
    <!-- Clean by removing build & doc directories -->
    <target name="cleanall" depends="clean" description="Remove all generated files.">
        <delete dir="${build.dir}" failonerror="no" />
        <delete dir="${doc.dir}"   failonerror="no" />
    </target>
    
    <!-- Compile all source -->
    <target name="compile" depends="prepare" description="Compiles all source code.">
        <javac destdir="${build.classes}" debug="${javac.debug}" optimize="yes" >
            <src path="${src.dir}" />
        </javac>
    </target>
    
    <!-- Javadoc -->
    <target name="javadoc" description="Create javadoc.">
        <mkdir dir="${doc.dir}" />
        <javadoc packagenames="org.jlab.coda.eventViewer"
                 sourcepath="java"
                 access="public"
                 destdir="${doc.dir}"
                 use="true" >
        </javadoc>
    </target>
    
    <!-- Javadoc for developer -->
    <target name="developdoc" description="Create javadoc for developer.">
        <mkdir dir="${doc.dir}" />
        <javadoc packagenames="org.jlab.coda.eventViewer"
                 sourcepath="java"
                 access="package"
                 destdir="${doc.dir}"
                 use="true" >
        </javadoc>
    </target>
    
    <!-- Create Jar file -->
    <target name="jar" depends="compile" description="Generates jar file.">
        <jar jarfile="${jarName}" manifest="${src.dir}/org/jlab/coda/eventViewer/manifest.mf">
            <fileset dir="${build.classes}" excludes="*.class" />
        </jar>
    </target>
    
    <!-- Clean, compile, and create jar -->
    <target name="all" depends="clean,jar" description="Cleans, compile, then builds jar file." />
    
    <!-- Install Jar file -->
    <target name="install" depends="jar" description="Installs jar file.">
        <antcall target="CODA_test"/>
    </target>
    
    <!-- Look for places to install the jar file (simulated if-then-else constructs) -->
    <target name="CODA_test">
        <condition property="CODA_Defined">
            <isset property="env.CODA"/>
        </condition>
        <antcall target="CODA_exists"/>
        <antcall target="CODA_exists_not"/>
    </target>
    
    <target name="CODA_exists" if="CODA_Defined">
        <echo message="Install ${jarName} into ${env.CODA}/jar" level="info" />
        <copy file="${jarName}" todir="${env.CODA}/jar"/>
    </target>
    
    <target name="CODA_exists_not" unless="CODA_Defined">
        <fail message="Define the CODA environmental variable to install, quitting" />
    </target>

</project>
